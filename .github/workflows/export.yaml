name: Export

on:
    workflow_call:
        inputs:
            data-type:
                required: true
                type: choice
                options:
                    - evapotranspiration
                    - maxtemp
                    - mintemp
                default: evapotranspiration

jobs:
    export:
        runs-on: ubuntu-latest
        steps:
            - name: ğŸ§¶ Checkout repository
              uses: actions/checkout@v4
              with:
                  persist-credentials: true

            - name: ğŸ§¶ Set up Node.js
              uses: actions/setup-node@v4
              with:
                  node-version: '24'

            - name: ğŸ§¶ Install dependencies
              run: npm ci

            - name: ğŸ§¶ Export data
              run: npm run export:${{ github.event.inputs.data-type }}

            - name: ğŸ§¶ Commit changes
              run: |
                  git config user.name "github-actions[bot]"
                  git config user.email "41898282+github-actions[bot]@users.noreply.github.com"

                  git add outputs/
                  if git diff --cached --quiet; then
                    echo "ğŸŸ¢ No changes to commit."
                  else
                    git commit -m "[auto] âš™ï¸ export ${{ github.event.inputs.data-type }} data"
                    git push
                  fi
